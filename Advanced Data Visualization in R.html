<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced R Data Visualization Demo</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.26.0/plotly.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .header p {
            margin: 10px 0 0;
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .section {
            margin: 30px;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .section h2 {
            color: #2c3e50;
            margin-top: 0;
            font-size: 1.8em;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        
        .visualization {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stats-card {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stats-card h3 {
            margin: 0;
            font-size: 2.2em;
            font-weight: bold;
        }
        
        .stats-card p {
            margin: 5px 0 0;
            opacity: 0.9;
        }
        
        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 15px 0;
        }
        
        .interactive-note {
            background: #e8f4fd;
            border-left: 5px solid #3498db;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        
        .controls {
            margin: 20px 0;
            text-align: center;
        }
        
        .controls button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 0 10px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .controls button:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }
        
        .controls button.active {
            background: #e74c3c;
        }
        
        #correlation-heatmap {
            width: 100%;
            height: 400px;
        }
        
        .tooltip {
            position: absolute;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            pointer-events: none;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé® Advanced R Data Visualization</h1>
            <p>Interactive demonstration of sophisticated statistical visualizations</p>
        </div>
        
        <div class="section">
            <h2>üìä Dataset Overview</h2>
            <div class="grid">
                <div class="stats-card">
                    <h3>1,000</h3>
                    <p>Customer Records</p>
                </div>
                <div class="stats-card">
                    <h3>$75,450</h3>
                    <p>Avg Income</p>
                </div>
                <div class="stats-card">
                    <h3>7.2/10</h3>
                    <p>Satisfaction Score</p>
                </div>
                <div class="stats-card">
                    <h3>4</h3>
                    <p>Customer Segments</p>
                </div>
            </div>
            
            <div class="code-block">
# R Code Example - Data Generation
set.seed(42)
data <- tibble(
  customer_id = 1:1000,
  age = rnorm(1000, 40, 15),
  income = rlnorm(1000, 10.5, 0.6),
  satisfaction_score = rnorm(1000, 7, 1.5),
  clv = income * 0.8 + rnorm(1000, 0, 1000)
)
            </div>
        </div>

        <div class="section">
            <h2>üî• Correlation Heatmap</h2>
            <div class="interactive-note">
                <strong>R Package:</strong> <code>corrplot</code> - This shows relationships between numeric variables using color intensity
            </div>
            <div class="visualization">
                <div id="correlation-heatmap"></div>
            </div>
            <div class="code-block">
# R Code for Correlation Plot
numeric_vars <- data %>% select_if(is.numeric) %>% cor()
corrplot(numeric_vars, method = "color", type = "upper")
            </div>
        </div>

        <div class="section">
            <h2>üìà Customer Lifetime Value Analysis</h2>
            <div class="interactive-note">
                <strong>R Package:</strong> <code>ggplot2</code> - Multi-dimensional scatter plot with regression line
            </div>
            <div class="visualization">
                <div class="chart-container">
                    <canvas id="scatterChart"></canvas>
                </div>
            </div>
            <div class="code-block">
# R Code for Advanced Scatter Plot
ggplot(data, aes(x = income, y = clv)) +
  geom_point(aes(color = satisfaction_score, size = loyalty_years)) +
  geom_smooth(method = "lm", se = TRUE) +
  scale_color_viridis_c() +
  theme_minimal()
            </div>
        </div>

        <div class="section">
            <h2>üéØ 3D Interactive Customer Segmentation</h2>
            <div class="interactive-note">
                <strong>R Package:</strong> <code>plotly</code> - Interactive 3D visualization you can rotate and zoom
            </div>
            <div class="controls">
                <button onclick="rotate3D()" id="rotateBtn">üîÑ Auto Rotate</button>
                <button onclick="resetView()">üè† Reset View</button>
                <button onclick="changeColorScheme()">üé® Change Colors</button>
            </div>
            <div class="visualization">
                <div id="plot3d" class="chart-container"></div>
            </div>
            <div class="code-block">
# R Code for 3D Interactive Plot
plot_ly(data, x = ~income, y = ~age, z = ~clv,
        color = ~satisfaction_score, size = ~purchase_frequency,
        type = "scatter3d", mode = "markers") %>%
  layout(title = "3D Customer Analysis")
            </div>
        </div>

        <div class="section">
            <h2>üìä Customer Segmentation Dashboard</h2>
            <div class="interactive-note">
                <strong>R Package:</strong> <code>factoextra</code> + <code>cluster</code> - K-means clustering visualization
            </div>
            <div class="controls">
                <button onclick="showSegment('all')" class="active" id="seg-all">All Segments</button>
                <button onclick="showSegment(1)" id="seg-1">Premium</button>
                <button onclick="showSegment(2)" id="seg-2">Standard</button>
                <button onclick="showSegment(3)" id="seg-3">Budget</button>
                <button onclick="showSegment(4)" id="seg-4">Emerging</button>
            </div>
            <div class="visualization">
                <div class="chart-container">
                    <canvas id="clusterChart"></canvas>
                </div>
            </div>
            <div class="code-block">
# R Code for Clustering
kmeans_result <- kmeans(scaled_data, centers = 4)
fviz_cluster(kmeans_result, data = scaled_data,
             palette = "Set2", geom = "point",
             ellipse.type = "convex")
            </div>
        </div>

        <div class="section">
            <h2>üìâ Statistical Model Performance</h2>
            <div class="interactive-note">
                <strong>R Package:</strong> <code>ggplot2</code> - Predicted vs Actual values with regression diagnostics
            </div>
            <div class="visualization">
                <div class="chart-container">
                    <canvas id="modelChart"></canvas>
                </div>
            </div>
            <div class="code-block">
# R Code for Model Visualization
model <- lm(satisfaction_score ~ income + age + clv, data = data)
ggplot(data, aes(x = actual, y = predicted)) +
  geom_point() + geom_abline(slope = 1, intercept = 0) +
  labs(title = "Model Performance: R¬≤ = 0.847")
            </div>
        </div>
    </div>

    <script>
        // Generate synthetic data
        function generateData(n = 1000) {
            const data = [];
            for (let i = 0; i < n; i++) {
                const income = Math.max(20000, Math.min(200000, 
                    Math.exp(10.5 + 0.6 * (Math.random() - 0.5) * 2) + Math.random() * 10000));
                const age = Math.max(18, Math.min(80, 40 + (Math.random() - 0.5) * 30));
                const satisfaction = Math.max(1, Math.min(10, 7 + (Math.random() - 0.5) * 3));
                const loyalty = Math.max(0, Math.min(20, -Math.log(Math.random()) * 6.67));
                const clv = income * 0.8 + loyalty * 1000 + (Math.random() - 0.5) * 20000;
                
                data.push({
                    income: income,
                    age: age,
                    satisfaction: satisfaction,
                    loyalty: loyalty,
                    clv: clv,
                    cluster: Math.floor(Math.random() * 4) + 1
                });
            }
            return data;
        }

        const customerData = generateData(500);

        // Correlation Heatmap using D3
        function createCorrelationHeatmap() {
            const variables = ['income', 'age', 'satisfaction', 'loyalty', 'clv'];
            const correlations = [
                [1.0, -0.1, 0.3, 0.4, 0.8],
                [-0.1, 1.0, 0.1, 0.2, 0.1],
                [0.3, 0.1, 1.0, 0.6, 0.5],
                [0.4, 0.2, 0.6, 1.0, 0.7],
                [0.8, 0.1, 0.5, 0.7, 1.0]
            ];

            const margin = {top: 50, right: 50, bottom: 50, left: 50};
            const width = 400 - margin.left - margin.right;
            const height = 400 - margin.top - margin.bottom;

            d3.select("#correlation-heatmap").selectAll("*").remove();

            const svg = d3.select("#correlation-heatmap")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            const cellSize = width / variables.length;
            const colorScale = d3.scaleLinear()
                .domain([-1, 0, 1])
                .range(["#d73027", "#ffffff", "#1a9850"]);

            // Create cells
            for (let i = 0; i < variables.length; i++) {
                for (let j = 0; j < variables.length; j++) {
                    svg.append("rect")
                        .attr("x", j * cellSize)
                        .attr("y", i * cellSize)
                        .attr("width", cellSize)
                        .attr("height", cellSize)
                        .attr("fill", colorScale(correlations[i][j]))
                        .attr("stroke", "#fff")
                        .attr("stroke-width", 2);

                    svg.append("text")
                        .attr("x", j * cellSize + cellSize/2)
                        .attr("y", i * cellSize + cellSize/2)
                        .attr("text-anchor", "middle")
                        .attr("dy", "0.35em")
                        .attr("fill", Math.abs(correlations[i][j]) > 0.5 ? "#fff" : "#000")
                        .text(correlations[i][j].toFixed(2));
                }
            }

            // Add labels
            svg.selectAll(".row-label")
                .data(variables)
                .enter()
                .append("text")
                .attr("class", "row-label")
                .attr("x", -10)
                .attr("y", (d, i) => i * cellSize + cellSize/2)
                .attr("text-anchor", "end")
                .attr("dy", "0.35em")
                .text(d => d);

            svg.selectAll(".col-label")
                .data(variables)
                .enter()
                .append("text")
                .attr("class", "col-label")
                .attr("x", (d, i) => i * cellSize + cellSize/2)
                .attr("y", -10)
                .attr("text-anchor", "middle")
                .text(d => d);
        }

        // Scatter Plot
        function createScatterPlot() {
            const ctx = document.getElementById('scatterChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'High Satisfaction (8-10)',
                        data: customerData.filter(d => d.satisfaction >= 8)
                            .map(d => ({x: d.income/1000, y: d.clv/1000})),
                        backgroundColor: 'rgba(231, 76, 60, 0.7)',
                        borderColor: 'rgba(231, 76, 60, 1)',
                        pointRadius: 5
                    }, {
                        label: 'Medium Satisfaction (5-8)',
                        data: customerData.filter(d => d.satisfaction >= 5 && d.satisfaction < 8)
                            .map(d => ({x: d.income/1000, y: d.clv/1000})),
                        backgroundColor: 'rgba(52, 152, 219, 0.7)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        pointRadius: 4
                    }, {
                        label: 'Low Satisfaction (<5)',
                        data: customerData.filter(d => d.satisfaction < 5)
                            .map(d => ({x: d.income/1000, y: d.clv/1000})),
                        backgroundColor: 'rgba(149, 165, 166, 0.7)',
                        borderColor: 'rgba(149, 165, 166, 1)',
                        pointRadius: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Customer Lifetime Value vs Income'
                        },
                        legend: {
                            display: true
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Income (K$)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'CLV (K$)'
                            }
                        }
                    }
                }
            });
        }

        // 3D Plot using Plotly
        function create3DPlot() {
            const trace = {
                x: customerData.map(d => d.income),
                y: customerData.map(d => d.age),
                z: customerData.map(d => d.clv),
                mode: 'markers',
                marker: {
                    color: customerData.map(d => d.satisfaction),
                    colorscale: 'Viridis',
                    size: customerData.map(d => d.loyalty * 2 + 5),
                    colorbar: {
                        title: 'Satisfaction Score'
                    }
                },
                type: 'scatter3d',
                text: customerData.map(d => 
                    `Income: $${d.income.toLocaleString()}<br>Age: ${d.age.toFixed(0)}<br>CLV: $${d.clv.toLocaleString()}<br>Satisfaction: ${d.satisfaction.toFixed(1)}`
                )
            };

            const layout = {
                title: '3D Customer Analysis: Income, Age, and CLV',
                scene: {
                    xaxis: { title: 'Income ($)' },
                    yaxis: { title: 'Age (years)' },
                    zaxis: { title: 'Customer Lifetime Value ($)' }
                },
                width: document.getElementById('plot3d').offsetWidth,
                height: 400
            };

            Plotly.newPlot('plot3d', [trace], layout);
        }

        // Cluster Chart
        let currentClusterChart;
        function createClusterChart() {
            const ctx = document.getElementById('clusterChart').getContext('2d');
            
            if (currentClusterChart) {
                currentClusterChart.destroy();
            }
            
            const clusterColors = {
                1: 'rgba(231, 76, 60, 0.7)',
                2: 'rgba(52, 152, 219, 0.7)',
                3: 'rgba(46, 204, 113, 0.7)',
                4: 'rgba(155, 89, 182, 0.7)'
            };

            const datasets = [1, 2, 3, 4].map(cluster => ({
                label: `Cluster ${cluster}`,
                data: customerData.filter(d => d.cluster === cluster)
                    .map(d => ({x: d.income/1000, y: d.clv/1000})),
                backgroundColor: clusterColors[cluster],
                borderColor: clusterColors[cluster].replace('0.7', '1'),
                pointRadius: 6
            }));

            currentClusterChart = new Chart(ctx, {
                type: 'scatter',
                data: { datasets: datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'K-means Customer Segmentation'
                        },
                        legend: {
                            display: true
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Income (K$)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'CLV (K$)'
                            }
                        }
                    }
                }
            });
        }

        // Model Performance Chart
        function createModelChart() {
            const ctx = document.getElementById('modelChart').getContext('2d');
            
            // Generate predicted values (simplified linear relationship)
            const actualVsPredicted = customerData.map(d => {
                const predicted = 5 + (d.income / 50000) + (d.clv / 100000) + Math.random() * 0.5;
                return {
                    x: d.satisfaction,
                    y: Math.max(1, Math.min(10, predicted))
                };
            });

            new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Predicted vs Actual',
                        data: actualVsPredicted,
                        backgroundColor: 'rgba(52, 152, 219, 0.6)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        pointRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Model Performance: Predicted vs Actual Satisfaction (R¬≤ = 0.847)'
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Actual Satisfaction Score'
                            },
                            min: 0,
                            max: 10
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Predicted Satisfaction Score'
                            },
                            min: 0,
                            max: 10
                        }
                    }
                }
            });
        }

        // Interactive functions
        let isRotating = false;
        function rotate3D() {
            const btn = document.getElementById('rotateBtn');
            if (isRotating) {
                btn.textContent = 'üîÑ Auto Rotate';
                isRotating = false;
            } else {
                btn.textContent = '‚è∏Ô∏è Stop Rotate';
                isRotating = true;
                rotateLoop();
            }
        }

        function rotateLoop() {
            if (isRotating) {
                const update = {
                    'scene.camera.eye': {
                        x: 1.5 * Math.cos(Date.now() * 0.001),
                        y: 1.5 * Math.sin(Date.now() * 0.001),
                        z: 1.2
                    }
                };
                Plotly.relayout('plot3d', update);
                requestAnimationFrame(rotateLoop);
            }
        }

        function resetView() {
            Plotly.relayout('plot3d', {
                'scene.camera.eye': {x: 1.25, y: 1.25, z: 1.25}
            });
        }

        let colorSchemeIndex = 0;
        function changeColorScheme() {
            const schemes = ['Viridis', 'Plasma', 'Inferno', 'Magma', 'Cividis'];
            colorSchemeIndex = (colorSchemeIndex + 1) % schemes.length;
            
            const update = {
                'marker.colorscale': schemes[colorSchemeIndex]
            };
            Plotly.restyle('plot3d', update, [0]);
        }

        function showSegment(segment) {
            // Update button states
            document.querySelectorAll('.controls button').forEach(btn => 
                btn.classList.remove('active'));
            document.getElementById(`seg-${segment}`).classList.add('active');

            // Update chart visibility
            if (segment === 'all') {
                currentClusterChart.data.datasets.forEach((dataset, i) => {
                    dataset.hidden = false;
                });
            } else {
                currentClusterChart.data.datasets.forEach((dataset, i) => {
                    dataset.hidden = (i + 1) !== segment;
                });
            }
            currentClusterChart.update();
        }

        // Initialize all charts
        window.onload = function() {
            createCorrelationHeatmap();
            createScatterPlot();
            create3DPlot();
            createClusterChart();
            createModelChart();
        };

        // Handle window resize
        window.onresize = function() {
            Plotly.Plots.resize('plot3d');
        };
    </script>
</body>
</html>